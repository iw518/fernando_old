{% extends "project_home.html" %}
{% block css %}
{{super()}}
{% endblock %}
{% block nav %}
{{super()}}
{% endblock %}
{% block main %}
<h2 class="text-center">静力触探曲线</h2>
<p>工程编号：{{projectNo}}</p>
<hr/>
<div class="container-fluid">
<div class="row">
    <form class="form-horizontal col-md-5" name='myform' role="form" method="POST">
        <fieldset style="margin:2px 2px;border:1px solid black;width:100%;">
            <legend style="padding:.20em;border:0;width:auto;">探头编号信息</legend>
            <div class="form-group">
                <label for="holeName" class="col-md-3 control-label">测试孔号：</label>
                <div class="col-md-8">
                    <select name='holeName' id="cptSelection" class="form-control" onClick="showCurve(this)">
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label for="probeNo" class="col-md-3 control-label">探头编号：</label>
                <div class="col-md-8">
                    <input type="text" name="probeNo" id="probeNo" class="form-control" required="required">
                </div>
            </div>
            <div class="form-group">
                <label for="probeArea" class="col-md-3 control-label">锥头面积：</label>
                <div class="col-md-8">
                    <input type="number" name="probeArea"  class="form-control" placeholder="15" required="required">
                </div>
            </div>
            <div class="form-group">
                <label for="fixedRatio" class="col-md-3 control-label">标定系数：</label>
                <div class="col-md-8">
                    <input type=text name="fixedRatio" class="form-control" required="required">
                </div>
            </div>
            <div class="form-group">
                <label for="testDate" class="col-md-3 control-label">测试日期：</label>
                <div class="col-md-8">
                    <input type="date" name="testDate" class="form-control" required="required">
                </div>
            </div>
            <div class="form-group">
                <div class="col-md-5 btn-group">
                    <button type=submit name="print_btn" class="btn btn-default" value="打印所有静力触探">打印所有静力触探</button>
                </div>
                <div class="col-md-5 btn-group">
                    <button type=submit name="print_btn" class="btn btn-default" value="打印单个静力触探">打印单个静力触探</button>
                </div>
            </div>
        </fieldset>
    </form>
    <div class="col-md-5 col-md-offset-2" style="position:relative;" id="ps_curve">
        <svg width="100%" height="1000px" version="1.1" xmlns="http://www.w3.org/2000/svg" onmousemove="showPs_label(event)" onmouseout="removePs_label(event)">
            <polyline id="cptCurve" style="fill:none;stroke:#000000;stroke-width:1"></polyline>
            <g transform="translate(0.5 0.5)">
                <line id="myline" style="stroke:red;"></line>
            </g>
        </svg>
    </div>
</div>
</div>
<div>
    <object data="{{url_for('static',filename='download/K081-2015/C1.PDF')}}" type="application/pdf" width="100%" height="100%">
        <p>It appears you don't have a PDF plugin for this browser.download the PDF file.</a></p>
        No biggie... you can <a href="{{url_for('static',filename='download/K081-2015/C1.PDF')}}">click here to
    </object>
</div>
<!--{% for xHole in holelist %}-->
<!--{%set cptstring=xHole.projectNo+'?holeName='+xHole.holeName %}-->
<!-- <div><a href="{{url_for('download',cptstring=cptstring)}}">{{xHole.holeName}}</a><div>-->
<!--{% endfor%}-->
{% endblock %}
{% block script%}
    {{super()}}
<script>
//javascript中可以直接使用jinjia2中的变量{{Variant}}
//myform.testDate.value=((new Date()).toLocaleDateString()).replace('年','-').replace('月','-').replace('日','');
function showCurve(obj){
    var myselect=document.getElementById("cptSelection");
    if (obj.options.length==0){
        {% for xHole in holelist %}
            var hole_option=new Option("{{xHole.holeName}}",{{loop.index}});
            obj.options.add(hole_option);
        {% endfor %}
    }
    //obj.opions[obj.selectedIndex].text获取某个选项的纯文本值
    //obj.opions[obj.selectedIndex].value获取被送往服务器的值
    //obj.selectedIndex获取options的索引值
    var selectHole=myselect.options[myselect.selectedIndex].text;
    //var selectIndex=myselect.selectedIndex;
    //alert("{{holelist[selectIndex]}}")holelist索引无法用变量，只能用数字或key
    var data=new Array();
    {% for xHole in holelist %}
        if ("{{xHole.holeName}}"==selectHole){
                {% for xPoint in xHole.testPoints %}
                    data.push("{{xPoint.testValue}}");
                {% endfor %}
            }
    {% endfor %}
    cptCurve = document.getElementById("cptCurve");
    cptCurve.setAttribute("points",genPoints(data));
}
function genData(){
    var selectHole=$("#cptSelection").find("option:selected").text();
    var data=new Array();
    {% for xHole in holelist %}
        if ("{{xHole.holeName}}"==selectHole){
                {% for xPoint in xHole.testPoints %}
                    data.push("{{xPoint.testValue}}");
                {% endfor %}
            }
    {% endfor %}
    return data;
}

function genPoints(data){
    var DPI=96;//the default value of windows DPIis 96
    //1in=2.54cm,the default value of windows DPIis 96
    var scale=200;//default print vertical scale is 1:200(but 1m contain 10 data considered),and horizontal scale is 1:2.
    var scaleX=100/2.54*DPI/scale;
    var scaleY=10/2.54*DPI/scale;
    var maxDep=400;//unit cm
    var maxPs=32;//unit MPa
    ////绘制曲线
    points="";
    for(var i=0;i<data.length;i++){
        var pX=scaleX*data[i];
        var pY=scaleY*i;
        points=points+" "+pX+","+pY;
    }
    return points;
}

function showPs_label(event){
    var data=genData();
    var DPI=96;
    var scale=200;
    var scaleY=10/2.54*DPI/scale;
    var i=parseInt((event.offsetY)/scaleY);

    if ($("#Ps_label").length==0){
        var labelXY=document.createElement("DIV");
        $("#ps_curve").append(labelXY);
        $(labelXY).attr("id","Ps_label");
    }
    $("#Ps_label").css("position","absolute");
    $("#Ps_label").css("left",event.offsetX+100);
    $("#Ps_label").css("top",event.offsetY);
    $("#Ps_label").attr("class","tip-bubble tip-bubble-left");
    $("#Ps_label").text(data[i]+"MPa");

    myline = document.getElementById("myline");
    myline.setAttribute("x1",0);
    myline.setAttribute("y1",event.offsetY);
    myline.setAttribute("x2",400);
    myline.setAttribute("y2",event.offsetY);
}
function removePs_label(event){
    $("#Ps_label").remove();
}
</script>
{%endblock%}